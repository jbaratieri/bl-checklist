<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Manual do LuthierPro ‚Äî Baratieri Luthieria</title>
    <style>
        :root {
            --accent: #8a623f;
            --muted: #666;
            --bg: #fff;
            --card: #fbfbfb;
            --maxw: 900px;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #222;
        }

        body {
            margin: 0;
            background: linear-gradient(180deg, #fff, #f7f6f4);
            padding: 28px;
        }

        .wrap {
            max-width: var(--maxw);
            margin: 0 auto;
            background: var(--bg);
            border-radius: 12px;
            padding: 26px 28px;
            box-shadow: 0 12px 40px rgba(20, 20, 20, 0.06)
        }

        header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 18px
        }

        header .brand {
            font-weight: 700;
            color: var(--accent);
            font-size: 1.1rem
        }

        header p {
            margin: 0;
            color: var(--muted);
            font-size: 0.95rem
        }

        h1 {
            margin: 0 0 6px 0;
            font-size: 1.25rem;
            color: #111
        }

        .meta {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 18px
        }

        nav.toc {
            border-left: 4px solid var(--accent);
            padding-left: 14px;
            margin: 14px 0 22px 0
        }

        nav.toc ul {
            margin: 8px 0 0 0;
            padding: 0 0 0 18px
        }

        nav.toc li {
            margin: 6px 0;
            color: var(--muted)
        }

        section.doc-section {
            margin-bottom: 20px
        }

        section.doc-section h2 {
            margin: 8px 0 10px 0;
            color: var(--accent);
            font-size: 1.05rem
        }

        p {
            line-height: 1.5;
            color: #222
        }

        .note {
            background: var(--card);
            padding: 10px;
            border-left: 3px solid var(--accent);
            border-radius: 6px;
            color: #333;
            margin-top: 10px
        }

        .kbd {
            background: #f4f4f4;
            border: 1px solid #e5e5e5;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.95rem
        }

        .actions {
            display: flex;
            gap: 8px;
            margin-top: 18px
        }

        .btn {
            background: var(--accent);
            color: #fff;
            padding: 10px 14px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600
        }

        footer.manual-foot {
            margin-top: 22px;
            padding-top: 12px;
            border-top: 1px solid #eee;
            color: var(--muted);
            font-size: 0.9rem
        }

        @media (max-width:640px) {
            .wrap {
                padding: 16px
            }

            header {
                flex-direction: column;
                align-items: flex-start
            }
        }

        /* =========================
           Estilos de impress√£o
           ========================= */
        @media print {
            html, body {
                height: auto !important;
                overflow: visible !important;
                background: #fff !important;
                padding: 0 !important;
            }
            .wrap {
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
                max-width: 100% !important;
                padding: 0.5cm !important;
            }
            /* esconder bot√µes e elementos de UI n√£o relevantes */
            .no-print, .actions { display: none !important; }
            /* for√ßar containers com overflow a expandir */
            .manual-container, .wrap { height: auto !important; max-height: none !important; overflow: visible !important; }
            .section, .doc-section { break-inside: avoid; page-break-inside: avoid; page-break-after: auto; }
            /* ajustar imagens para caber na p√°gina */
            img { max-width: 100% !important; height: auto !important; }
            * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>

<body>
    <!-- observe que acrescentei a classe manual-container (usada no print) -->
    <div class="wrap manual-container">
        <header>
            <div>
                <div class="brand">LuthierPro ‚Äî Manual do Usu√°rio</div>
                <p>Baratieri Luthieria ¬∑ Vers√£o do App: <strong>v2.4.3</strong></p>
            </div>
        </header>

        <h1>Resumo</h1>
        <p>Este manual descreve o uso do LuthierPro: instala√ß√£o, painel de projetos, checklists, imagens e ‚Äî
            especialmente ‚Äî o procedimento de <strong>Backup & Restaura√ß√£o</strong>.</p>
        <p class="meta">Recomenda√ß√£o: imprima ou salve este PDF para refer√™ncia. O app tamb√©m permite exportar/importar
            projetos em .json.</p>

        <h2>Links oficiais</h2>
        <ul>
            <li>üåê <strong>App LuthierPro:</strong> <a href="https://luthierpro.vercel.app/index.html" target="_blank"
                    rel="noopener">https://luthierpro.vercel.app/index.html</a></li>
            <li>üîë <strong>P√°gina de Login:</strong> <a href="https://luthierpro.vercel.app/login.html"
                    target="_blank" rel="noopener">https://luthierpro.vercel.app/login.html</a></li>
            <li>üéüÔ∏è <strong>Resgatar Licen√ßa:</strong> <a href="https://luthierpro.vercel.app/resgatar.html"
                    target="_blank" rel="noopener">https://luthierpro.vercel.app/resgatar.html</a></li>
        </ul>

        <div class="note">
            üí° Dica: ap√≥s resgatar a licen√ßa, basta acessar o login normalmente.
            O app reconhece automaticamente o dispositivo e ativa o acesso.
        </div>

        <nav class="toc" aria-label="Sum√°rio">
            <strong>Sum√°rio</strong>
            <ul>
                <li><a href="#install">1. Acesso e Instala√ß√£o</a></li>
                <li><a href="#panel">2. Painel do Projeto</a></li>
                <li><a href="#checklists">3. Checklists e Etapas</a></li>
                <li><a href="#images">4. Imagens e Desenhos</a></li>
                <li><a href="#backup">5. Backup & Restaura√ß√£o (essencial)</a></li>
                <li><a href="#license">6. Licenciamento</a></li>
                <li><a href="#updates">7. Atualiza√ß√µes</a></li>
                <li><a href="#recommend">8. Recomenda√ß√µes</a></li>
                <li><a href="#support">9. Suporte</a></li>
            </ul>
        </nav>

        <section id="install" class="doc-section">
            <h2>1. Acesso e Instala√ß√£o</h2>
            <p>Acesse o LuthierPro pela URL fornecida. Recomendamos um navegador moderno (Chrome, Edge, Firefox ou
                Safari). Para uso offline e conforto, instale como PWA clicando no bot√£o <span class="kbd">üì≤ Instalar
                    LuthierPro</span> no canto (quando dispon√≠vel).</p>
            <div class="note">Instalar como app permite √≠cone na √°rea de trabalho e comportamento offline mais fluido.
            </div>
        </section>

        <section id="panel" class="doc-section">
            <h2>2. Painel do Projeto</h2>
            <p>No painel voc√™ seleciona o <strong>Instrumento</strong> e o <strong>Projeto</strong> (criar / renomear /
                excluir). Campos importantes: cliente, data de in√≠cio, data prevista, dias/semana.</p>
            <p>Os bot√µes principais para o projeto s√£o: <strong>Cronograma</strong>, <strong>Medidas</strong>, e os
                controles de export/import (Backup/Restore).</p>
        </section>

        <section id="checklists" class="doc-section">
            <h2>3. Checklists e Etapas</h2>
            <p>Cada se√ß√£o do guia (1..12) cont√©m tarefas com checkboxes. O progresso √© salvo automaticamente no
                navegador (localStorage). Marque as tarefas conforme conclui para o app calcular o progresso e destacar
                se uma se√ß√£o est√° completa.</p>
        </section>

        <section id="images" class="doc-section">
            <h2>4. Imagens e Desenhos</h2>
            <p>Voc√™ pode anexar imagens por passo. Clique na miniatura para abrir o <strong>Lightbox</strong>. Para
                anota√ß√µes t√©cnicas, utilize a ferramenta de desenho (abrir√° um modal com canvas).</p>
            <p class="note">As imagens s√£o salvas localmente no navegador em <strong>IndexedDB</strong> (armazenamento
                separado do localStorage). Mesmo offline, as imagens s√£o preservadas no dispositivo.</p>
        </section>

        <section id="backup" class="doc-section">
            <h2>5. Backup & Restaura√ß√£o (essencial)</h2>
            <p>O backup garante que voc√™ n√£o perca projetos ao limpar cache, trocar de navegador ou dispositivo.</p>

            <h3>Como exportar</h3>
            <ol>
                <li>Acesse o Painel de Projeto.</li>
                <li>Clique em <strong>Exportar projeto atual</strong> para salvar apenas o projeto selecionado.</li>
                <li>Clique em <strong>Exportar TODOS os projetos</strong> para gerar backup completo.</li>
                <li>Guarde o arquivo `.json` em local seguro: HD externo, Google Drive, Dropbox ou pendrive.</li>
            </ol>

            <h3>Como importar</h3>
            <ol>
                <li>Clique em <strong>Importar</strong> e escolha o arquivo `.json` salvo.</li>
                <li>Modo <strong>Merge</strong>: adiciona/atualiza sem apagar projetos existentes.</li>
                <li>Modo <strong>Overwrite</strong>: substitui dados existentes (perigoso ‚Äî usar com cuidado).</li>
                <li>Ap√≥s importar, recarregue a p√°gina se o app n√£o synchronizar automaticamente (alguns nomes/imagens
                    podem aparecer ap√≥s reload).</li>
            </ol>

            <h3>Recomenda√ß√µes pr√°ticas</h3>
            <ul>
                <li>Fa√ßa backup regular ‚Äî pelo menos 1√ó por semana se tiver muitos projetos.</li>
                <li>Antes de atualizar, limpar cache ou desinstalar, exporte todos os projetos.</li>
                <li>Armazene backups em dois locais (por exemplo: Drive + um pendrive f√≠sico).</li>
                <li>Use sempre o modo <strong>Merge</strong> salvo se realmente quiser sobrescrever.</li>
            </ul>

            <div class="note">
                Dica t√©cnica: ao restaurar um projeto individual, o app popula IndexedDB (imagens) e localStorage; se
                algo faltar (nome do projeto) recarregue a p√°gina (F5) ‚Äî comportamento normal em algumas implementa√ß√µes.
                Nosso app j√° tenta sincronizar automaticamente quando poss√≠vel.
            </div>
        </section>

        <section id="license" class="doc-section">
            <h2>6. Licenciamento</h2>
            <p>O LuthierPro utiliza um sistema de licen√ßa individual, validada automaticamente uma vez a cada 24 h.
                Mesmo sem internet, o app continua funcionando por at√© <strong>5 dias</strong>.</p>

            <p>Se o app indicar que a licen√ßa est√° expirada ou bloqueada, basta fazer login novamente:</p>

            <ul>
                <li>üîë <strong>Login:</strong> <a href="https://luthierpro.vercel.app/login.html" target="_blank"
                        rel="noopener">https://luthierpro.vercel.app/login.html</a></li>
                <li>üéüÔ∏è <strong>Resgatar Licen√ßa:</strong> <a href="https://luthierpro.vercel.app/resgatar.html"
                        target="_blank" rel="noopener">https://luthierpro.vercel.app/resgatar.html</a></li>
            </ul>

            <div class="note">
                Para resgatar, informe o mesmo e-mail usado na compra.
                O sistema localizar√° sua licen√ßa ativa e a restaurar√° automaticamente.
            </div>

            <p>Voc√™ pode confirmar o status da licen√ßa no rodap√© do app:
                <em>üîê Licen√ßa ativa (mensal ‚Ä¢ at√© DD/MM/AAAA)</em> ou <em>‚õî Expirada</em>.
            </p>
        </section>

        <section id="updates" class="doc-section">
            <h2>7. Atualiza√ß√µes do App</h2>
            <p>Quando houver atualiza√ß√£o, o app mostrar√° um banner ‚ÄúNova vers√£o dispon√≠vel ‚Äî Atualizar‚Äù. Clique para
                aplicar a nova vers√£o ‚Äî o processo n√£o altera os dados salvos (localStorage/IndexedDB permanecem).</p>
        </section>

        <section id="recommend" class="doc-section">
            <h2>8. Recomenda√ß√µes de Uso</h2>
            <ul>
                <li>Use navegador atualizado</li>
                <li>Instale como PWA para melhor experi√™ncia offline</li>
                <li>N√£o limpe o armazenamento do navegador sem antes exportar seus projetos</li>
                <li>Mantenha backups regulares</li>
            </ul>
        </section>

        <section id="support" class="doc-section">
            <h2>9. Suporte</h2>
            <p>Para suporte t√©cnico e d√∫vidas:</p>
            <ul>
                <li>E-mail: <a href="mailto:baratieriluthieria@gmail.com">baratieriluthieria@gmail.com</a></li>
                <li>WhatsApp: <a href="https://wa.me/5545920028659" target="_blank" rel="noopener">(45) 92002-8659</a>
                </li>
                <li>Instagram: <a href="https://instagram.com/baratieri_luthieria" target="_blank"
                        rel="noopener">@baratieri_luthieria</a></li>
            </ul>
        </section>

        <div class="actions">
            <!-- bot√£o atualizado para usar a fun√ß√£o que gera a janela de impress√£o -->
            <button class="btn" onclick="printManual()">Imprimir / Salvar PDF</button>
            <a href="/" style="text-decoration:none"><button class="btn" style="background:#555">Voltar ao
                    app</button></a>
            <a href="https://luthierpro.vercel.app/index.html" target="_blank" rel="noopener">
                <button class="btn">Abrir LuthierPro</button>
            </a>
        </div>

        <footer class="manual-foot">
            <div>Baratieri Luthieria ‚Ä¢ LuthierPro ‚Ä¢ ¬© 2025</div>
        </footer>
    </div>

    <script>
        /**
         * printManual()
         * - clona o container .manual-container numa nova janela
         * - injeta estilos existentes
         * - garante <details> abertos e imagens carregadas antes de imprimir
         * - chama window.print() e fecha a janela ap√≥s print
         */
        function gatherStylesHtml() {
            // pega todas as tags <style> e <link rel="stylesheet"> do documento atual
            let html = '';
            document.querySelectorAll('link[rel="stylesheet"], style').forEach(node => {
                html += node.outerHTML;
            });

            // adiciona um bloco extra de CSS de impress√£o (fallback)
            html += `<style>
                @media print {
                  html,body{height:auto !important;overflow:visible !important;}
                  .no-print, .actions { display: none !important; }
                  .manual-container, .wrap { height:auto !important; max-height:none !important; overflow:visible !important; }
                  .section, .doc-section { break-inside: avoid; page-break-inside: avoid; }
                  img{max-width:100% !important;height:auto !important;}
                  *{-webkit-print-color-adjust:exact; print-color-adjust:exact;}
                }
            </style>`;
            return html;
        }

        function waitForImagesToLoad(container) {
            const imgs = Array.from(container.querySelectorAll('img'));
            if (imgs.length === 0) return Promise.resolve();
            const checks = imgs.map(img => {
                if (img.complete) return Promise.resolve();
                return new Promise(res => {
                    img.onload = img.onerror = () => res();
                    // caso fique travado, timeout como fallback
                    setTimeout(res, 5000);
                });
            });
            return Promise.all(checks);
        }

        function expandAllDetails(cloneDoc) {
            // abre todos os <details>
            cloneDoc.querySelectorAll('details').forEach(d => d.open = true);
            // remove atributos inline de 'display:none' usados por accordions (heur√≠stica)
            cloneDoc.querySelectorAll('[style*="display:none"]').forEach(el => {
                el.style.display = '';
            });
            // remove classes 'hidden' comuns
            cloneDoc.querySelectorAll('.hidden, .is-hidden, [aria-hidden="true"]').forEach(el => {
                el.removeAttribute('aria-hidden');
                el.classList.remove('hidden', 'is-hidden');
                el.style.display = '';
            });
        }

        function printManual() {
            const sourceEl = document.querySelector('.manual-container') || document.body;
            const styles = gatherStylesHtml();
            const content = sourceEl.innerHTML;

            // abrir janela ‚Äî acionado por clique do usu√°rio, ent√£o pop-up permitido
            const w = window.open('', '_blank', 'noopener,noreferrer');
            if (!w) {
                alert('N√£o foi poss√≠vel abrir a janela de impress√£o. Permita popups para este site e tente novamente.');
                return;
            }

            const doc = w.document;
            doc.open();
            doc.write(`<!doctype html><html><head><meta charset="utf-8"><title>Imprimir - LuthierPro</title>${styles}</head><body><div class="wrap manual-container">${content}</div></body></html>`);
            doc.close();

            // quando a nova janela terminar de carregar, garantimos que tudo esteja pronto
            w.onload = async () => {
                try {
                    expandAllDetails(w.document);
                    await waitForImagesToLoad(w.document);
                } catch (e) {
                    // ignorar erros menores e seguir
                    console.warn('Erro ao preparar impress√£o: ', e);
                }

                // pequena espera pra reflow; ent√£o imprime
                setTimeout(() => {
                    // chama print e fecha a janela depois
                    try {
                        w.focus();
                        w.print();
                    } catch (err) {
                        console.warn('Erro print():', err);
                    }
                    // fecha a janela ap√≥s o print dialog fechar (onafterprint pode n√£o disparar em todos os browsers)
                    w.onafterprint = () => w.close();
                    // fallback para fechar (n√£o fecha se usu√°rio cancelar dialog)
                    setTimeout(() => {
                        try { w.close(); } catch (e) { /* noop */ }
                    }, 1000);
                }, 200);
            };
        }
    </script>
</body>

</html>
